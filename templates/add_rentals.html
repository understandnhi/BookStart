<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω ƒê∆°n Thu√™</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>


           <!-- üèó MENU ƒêI·ªÄU H∆Ø·ªöNG -->

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">üìö BOOKSTART</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('views.index') }}">üìñ Qu·∫£n l√Ω S√°ch</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('customer_views.manage_customers') }}">üë§ Qu·∫£n l√Ω Kh√°ch h√†ng</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="{{ url_for('rental_views.manage_rentals') }}">üìñ Qu·∫£n l√Ω ƒë∆°n thu√™</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


    <div class="container mt-5">
        <h2 class="mb-4">T·∫°o ƒê∆°n Thu√™ S√°ch</h2>

        <!-- Form nh·∫≠p th√¥ng tin kh√°ch h√†ng -->
        <div class="card p-4 mb-3">
            <h5>Th√¥ng tin kh√°ch h√†ng</h5>
            <div class="mb-3">
                <label class="form-label">T√™n kh√°ch h√†ng</label>
                <input type="text" id="customer_name" class="form-control" placeholder="Nh·∫≠p t√™n kh√°ch h√†ng">
            </div>
            <div class="mb-3">
                <label class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                <input type="text" id="customer_phone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
            </div>
        </div>

        <!-- Form nh·∫≠p th√¥ng tin s√°ch thu√™ -->
        <div class="card p-4 mb-3">
            <h5>Danh s√°ch s√°ch thu√™</h5>
            <table class="table">
                <thead>
                    <tr>
                        <th>ID s√°ch</th>
                        <th>S·ªë l∆∞·ª£ng</th>
                        <th>Ng√†y tr·∫£</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="books_list">
                    <tr>
                        <td><input type="number" class="form-control book_id" placeholder="ID s√°ch"></td>
                        <td><input type="number" class="form-control rental_quantity" placeholder="S·ªë l∆∞·ª£ng"></td>
                        <td><input type="date" class="form-control return_due_date"></td>
                        <td><button class="btn btn-danger remove-book">X√≥a</button></td>
                    </tr>
                </tbody>
            </table>
            <button id="add_book" class="btn btn-primary">Th√™m s√°ch</button>
        </div>

        <!-- N√∫t g·ª≠i ƒë∆°n thu√™ -->
        <button id="submit_rental" class="btn btn-success">T·∫°o ƒê∆°n Thu√™</button>

        <!-- Th√¥ng b√°o k·∫øt qu·∫£ -->
        <div id="message" class="mt-3"></div>
    </div>

    <script>
        $(document).ready(function() {
            // Th√™m d√≤ng m·ªõi ƒë·ªÉ nh·∫≠p th√¥ng tin s√°ch
            $("#add_book").click(function() {
                $("#books_list").append(`
                    <tr>
                        <td><input type="number" class="form-control book_id" placeholder="ID s√°ch"></td>
                        <td><input type="number" class="form-control rental_quantity" placeholder="S·ªë l∆∞·ª£ng"></td>
                        <td><input type="date" class="form-control return_due_date"></td>
                        <td><button class="btn btn-danger remove-book">X√≥a</button></td>
                    </tr>
                `);
            });

            // X√≥a d√≤ng nh·∫≠p s√°ch
            $(document).on("click", ".remove-book", function() {
                $(this).closest("tr").remove();
            });

            // G·ª≠i y√™u c·∫ßu t·∫°o ƒë∆°n thu√™
            $("#submit_rental").click(function() {
                let customer_name = $("#customer_name").val();
                let customer_phone = $("#customer_phone").val();
                let books = [];

                // L·∫•y danh s√°ch s√°ch thu√™
                $("#books_list tr").each(function() {
                    let book_id = $(this).find(".book_id").val();
                    let rental_quantity = $(this).find(".rental_quantity").val();
                    let return_due_date = $(this).find(".return_due_date").val();

                    if (book_id && rental_quantity && return_due_date) {
                        books.push({
                            book_id: parseInt(book_id),
                            rental_quantity: parseInt(rental_quantity),
                            return_due_date: return_due_date
                        });
                    }
                });

                if (!customer_name || !customer_phone || books.length === 0) {
                    $("#message").html('<div class="alert alert-danger">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!</div>');
                    return;
                }

                // G·ª≠i API t·∫°o ƒë∆°n thu√™
                $.ajax({
                    url: "/rentals",
                    type: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({
                        customer_name: customer_name,
                        customer_phone: customer_phone,
                        books: books
                    }),
                    success: function(response) {
                        $("#message").html('<div class="alert alert-success">' + response.message + '</div>');
                    },
                    error: function(xhr) {
                        $("#message").html('<div class="alert alert-danger">' + xhr.responseJSON.message + '</div>');
                    }
                });
            });
        });
    </script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>
